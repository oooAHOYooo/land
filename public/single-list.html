<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>AGSCOUT — Single Family (List)</title>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body class="bg-slate-50 text-slate-900 min-h-screen">
        <div class="max-w-6xl mx-auto p-4 md:p-6 space-y-4">
            <header class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-semibold">AGSCOUT — Single Family (List)</h1>
                    <p class="text-sm text-slate-500">Built from <code class="font-mono">/public/data/single.json</code></p>
                </div>
                <div class="flex items-center gap-2 no-print">
                    <button onclick="window.print()" class="px-3 py-2 rounded-md bg-white shadow-sm border text-slate-700 hover:bg-slate-50">Print</button>
                    <a href="single.html" class="px-3 py-2 rounded-md bg-white shadow-sm border text-slate-700 hover:bg-slate-50">Back to app</a>
                </div>
            </header>

            <section class="bg-white rounded-lg shadow-sm border p-3 md:p-4">
                <div class="flex items-center justify-between">
                    <div class="text-sm text-slate-600">Total: <strong id="count">0</strong></div>
                </div>
                <div id="list" class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-3"></div>
                <div id="empty" class="mt-3 text-center text-slate-500 text-sm hidden">No properties</div>
            </section>
        </div>

        <script>
  async function main() {
    try {
      const res = await fetch('data/single.json', { cache: 'no-store' });
      if (!res.ok) throw new Error('Failed to load JSON');
      const arr = await res.json();
      const rows = Array.isArray(arr) ? arr : [];
      document.getElementById('count').textContent = String(rows.length);
      const container = document.getElementById('list');
      const empty = document.getElementById('empty');
      if (rows.length === 0) { empty.classList.remove('hidden'); return; }
      const fmtCurrency = (v) => (v==null||!isFinite(Number(v)) ? '' : '$' + Number(v).toLocaleString(undefined, { maximumFractionDigits: 0 }));
      const fmtNumber = (v, d=0) => (v==null||!isFinite(Number(v)) ? '' : Number(v).toLocaleString(undefined, { maximumFractionDigits: d }));
      const escapeHtml = (s) => String(s==null?'':s)
        .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;');

      const cards = rows.map((r) => {
        const pricePerSqft = (r.Sqft && r.Price) ? (Number(r.Price) / Number(r.Sqft)) : null;
        const yieldPct = (r.Price && r.RentZestimate) ? ((Number(r.RentZestimate)*12)/Number(r.Price))*100 : null;
        return `
        <div class="border rounded-md p-3 bg-white">
          <div class="flex items-start justify-between gap-2">
            <div class="min-w-0">
              <div class="font-semibold truncate">${escapeHtml(r.Address || '')}</div>
              <div class="text-xs text-slate-500 truncate">${escapeHtml([r.City, r.State].filter(Boolean).join(', '))}</div>
            </div>
            <div class="text-right flex-none">
              <div class="text-sm font-medium">${escapeHtml(fmtCurrency(r.Price))}</div>
              <div class="text-xs text-slate-500">${escapeHtml(r.Tag || 'inbox')}</div>
            </div>
          </div>
          <div class="mt-2 grid grid-cols-2 md:grid-cols-4 gap-2 text-sm">
            <div><div class="text-xs text-slate-500">Beds</div><div class="font-medium">${escapeHtml(fmtNumber(r.Beds,0))}</div></div>
            <div><div class="text-xs text-slate-500">Baths</div><div class="font-medium">${escapeHtml(fmtNumber(r.Baths,0))}</div></div>
            <div><div class="text-xs text-slate-500">Sqft</div><div class="font-medium">${escapeHtml(fmtNumber(r.Sqft,0))}</div></div>
            <div><div class="text-xs text-slate-500">$/Sqft</div><div class="font-medium">${escapeHtml(fmtCurrency(pricePerSqft))}</div></div>
            <div><div class="text-xs text-slate-500">Rent est.</div><div class="font-medium">${escapeHtml(fmtCurrency(r.RentZestimate))}</div></div>
            <div><div class="text-xs text-slate-500">Rent Yield</div><div class="font-medium">${yieldPct!=null ? escapeHtml(yieldPct.toFixed(2)+'%') : ''}</div></div>
            <div><div class="text-xs text-slate-500">Taxes (annual)</div><div class="font-medium">${escapeHtml(fmtCurrency(r.TaxesAnnual))}</div></div>
            <div><div class="text-xs text-slate-500">Insurance (annual)</div><div class="font-medium">${escapeHtml(fmtCurrency(r.InsuranceAnnual))}</div></div>
            <div><div class="text-xs text-slate-500">HOA (monthly)</div><div class="font-medium">${escapeHtml(fmtCurrency(r.HOAmonthly))}</div></div>
          </div>
          <div class="mt-2 flex items-center gap-3 text-sm">
            ${r.Link ? `<a href="${escapeHtml(r.Link)}" target="_blank" class="text-indigo-600 underline">View listing</a>` : ''}
            ${r.Notes ? `<span class="text-slate-500">${escapeHtml(r.Notes)}</span>` : ''}
          </div>
        </div>`;
      }).join('\n');
      container.innerHTML = cards;
    } catch (e) {
      document.getElementById('empty').textContent = 'Failed to load single.json';
      document.getElementById('empty').classList.remove('hidden');
    }
  }
  main();
        </script>
        <style>
          @media print {
            .no-print { display: none !important; }
            body { background: white; }
          }
        </style>
    </body>
</html>


